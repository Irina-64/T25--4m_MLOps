–õ–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–∞—è —Ä–∞–±–æ—Ç–∞ ‚Ññ10 ‚Äî –î–µ–ø–ª–æ–π –≤ Kubernetes (Minikube)
–ü—Ä–æ–µ–∫—Ç: RL-–∞–≥–µ–Ω—Ç –¥–ª—è –∫–∞—Ä—Ç–æ—á–Ω–æ–π –∏–≥—Ä—ã ¬´–î—É—Ä–∞–∫¬ª



 –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã

Minikube v1.37.0

Docker Desktop (–¥–ª—è —Å–±–æ—Ä–∫–∏ –æ–±—Ä–∞–∑–∞ –∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å Minikube)

kubectl (–¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–ª–∞—Å—Ç–µ—Ä–æ–º)

PowerShell (–¥–ª—è –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ FastAPI)

FastAPI / Uvicorn ‚Äî REST API –¥–ª—è RL-–∞–≥–µ–Ω—Ç–∞

Python 3.11, –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∏–∑ requirements.txt

3Ô∏è‚É£ –û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞

–ü—Ä–æ–µ–∫—Ç —Ä–µ–∞–ª–∏–∑—É–µ—Ç RL-–∞–≥–µ–Ω—Ç–∞ –¥–ª—è –∫–∞—Ä—Ç–æ—á–Ω–æ–π –∏–≥—Ä—ã ¬´–î—É—Ä–∞–∫¬ª:

/reset ‚Äî —Å–±—Ä–æ—Å –∏–≥—Ä—ã

/step ‚Äî —Å–¥–µ–ª–∞—Ç—å —Ö–æ–¥ (POST, –ø–∞—Ä–∞–º–µ—Ç—Ä {"action":"take"} –∏ —Ç.–¥.)

/legal_actions ‚Äî –ø–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Ö–æ–¥–æ–≤ –¥–ª—è –∏–≥—Ä–æ–∫–∞

–ö–æ–¥ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ –ø–∞–ø–∫–∞—Ö:

src/Api.py ‚Äî FastAPI

env/durak_env.py ‚Äî —Å—Ä–µ–¥–∞ –∏–≥—Ä—ã

Core/agents.py, Core/core.py ‚Äî –ª–æ–≥–∏–∫–∞ RL-–∞–≥–µ–Ω—Ç–∞ –∏ –∏–≥—Ä—ã

Dockerfile ‚Äî –æ–±—Ä–∞–∑ Python —Å –ø—Ä–æ–µ–∫—Ç–æ–º

4Ô∏è‚É£ –®–∞–≥–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–æ–π
4.1 –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Minikube –∏ Docker

–£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω Minikube (minikube version)

–£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω Docker Desktop

–ü—Ä–æ–≤–µ—Ä–µ–Ω–æ —Å–æ—Å—Ç–æ—è–Ω–∏–µ Docker:

docker info

4.2 –°–±–æ—Ä–∫–∞ Docker-–æ–±—Ä–∞–∑–∞ –∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Minikube
# –ü–µ—Ä–µ–π—Ç–∏ –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é —Å –ø—Ä–æ–µ–∫—Ç–æ–º –∏ Dockerfile
cd "C:\Users\ilua2\OneDrive\–†–∞–±–æ—á–∏–π_—Å—Ç–æ–ª\–•–õ–ê–ú\–ü—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ\T25--4m_MLOps"

# –°–±–æ—Ä–∫–∞ –æ–±—Ä–∞–∑–∞
docker build -t durak-rl-api:lab10 .

# –ó–∞–≥—Ä—É–∂–∞–µ–º –æ–±—Ä–∞–∑ –≤ Minikube
minikube image load durak-rl-api:lab10

4.3 –°–æ–∑–¥–∞–Ω–∏–µ –º–∞–Ω–∏—Ñ–µ—Å—Ç–æ–≤ Kubernetes

deployment.yaml

apiVersion: apps/v1
kind: Deployment
metadata:
  name: durak-rl-api
  labels:
    app: durak-rl-api
spec:
  replicas: 1
  selector:
    matchLabels:
      app: durak-rl-api
  template:
    metadata:
      labels:
        app: durak-rl-api
    spec:
      containers:
        - name: durak-rl-api
          image: durak-rl-api:lab10
          imagePullPolicy: Never
          ports:
            - containerPort: 8000


service.yaml (NodePort)

apiVersion: v1
kind: Service
metadata:
  name: durak-rl-api
spec:
  type: NodePort
  selector:
    app: durak-rl-api
  ports:
    - protocol: TCP
      port: 8000
      targetPort: 8000


hpa.yaml (HorizontalPodAutoscaler)

apiVersion: autoscaling/v2
kind: HorizontalPodAutoscaler
metadata:
  name: durak-rl-api-hpa
spec:
  scaleTargetRef:
    apiVersion: apps/v1
    kind: Deployment
    name: durak-rl-api
  minReplicas: 1
  maxReplicas: 5
  metrics:
    - type: Resource
      resource:
        name: cpu
        target:
          type: Utilization
          averageUtilization: 50

4.4 –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –º–∞–Ω–∏—Ñ–µ—Å—Ç–æ–≤
kubectl apply -f k8s/
kubectl get pods,svc


–ü—Ä–æ–≤–µ—Ä–µ–Ω–æ, —á—Ç–æ Pod Running

NodePort —Å–µ—Ä–≤–∏—Å –¥–æ—Å—Ç—É–ø–µ–Ω:

minikube service durak-rl-api --url
# –Ω–∞–ø—Ä–∏–º–µ—Ä, http://127.0.0.1:51587

4.5 –ü—Ä–æ–≤–µ—Ä–∫–∞ FastAPI
# –°–±—Ä–æ—Å –∏–≥—Ä—ã
Invoke-RestMethod -Uri "http://127.0.0.1:<PORT>/reset"

# –°–¥–µ–ª–∞—Ç—å —Ö–æ–¥
Invoke-RestMethod -Uri "http://127.0.0.1:<PORT>/step" -Method POST -ContentType "application/json" -Body '{"action":"take"}'

# –õ–µ–≥–∞–ª—å–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è
Invoke-RestMethod -Uri "http://127.0.0.1:<PORT>/legal_actions"


–í—Å—ë —Ä–∞–±–æ—Ç–∞–µ—Ç: —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∏–≥—Ä—ã, —Ö–æ–¥—ã –∏ –ª–µ–≥–∞–ª—å–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã

4.6 –ü—Ä–æ–≤–µ—Ä–∫–∞ HorizontalPodAutoscaler

–°–º–æ—Ç—Ä–∏–º —Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ HPA:

kubectl get hpa


–ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –Ω–∞–≥—Ä—É–∑–∫—É –¥–ª—è —É–≤–µ–ª–∏—á–µ–Ω–∏—è CPU:

for ($i=0; $i -lt 200; $i++) { 
    Invoke-RestMethod -Uri "http://127.0.0.1:<PORT>/reset" 
}


–ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ Pods:

kubectl get pods -w


–ü—Ä–∏ —Ä–æ—Å—Ç–µ –Ω–∞–≥—Ä—É–∑–∫–∏ HPA —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç —á–∏—Å–ª–æ Pod‚Äô–æ–≤ –¥–æ MAXPODS

–ü–æ—Å–ª–µ —Å–Ω–∏–∂–µ–Ω–∏—è –Ω–∞–≥—Ä—É–∑–∫–∏ ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ Pods –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –∫ MINPODS

5Ô∏è‚É£ –ò—Ç–æ–≥–∏

–†–∞–∑–≤–µ—Ä–Ω—É—Ç –ª–æ–∫–∞–ª—å–Ω—ã–π Kubernetes-–∫–ª–∞—Å—Ç–µ—Ä —Å Minikube

–°–æ–∑–¥–∞–Ω Docker-–æ–±—Ä–∞–∑ —Å FastAPI RL-–∞–≥–µ–Ω—Ç–æ–º

–ù–∞—Å—Ç—Ä–æ–µ–Ω Deployment, NodePort Service –∏ HPA

–ü—Ä–æ–≤–µ—Ä–µ–Ω—ã –≤—Å–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã /reset, /step, /legal_actions

–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–æ, —á—Ç–æ HPA –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ—Ç Pods –ø—Ä–∏ –Ω–∞–≥—Ä—É–∑–∫–µ

üí° –õ–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–∞—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é.

–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –∑–∞–ø—É—Å–∫—É API —á–µ—Ä–µ–∑ Kubernetes –Ω–∞ –≤–∞—à–µ–π –º–∞—à–∏–Ω–µ

–û—Ç–∫—Ä—ã—Ç—å PowerShell

–ü–µ—Ä–µ–π—Ç–∏ –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –ø—Ä–æ–µ–∫—Ç–∞ —Å Dockerfile:

cd "C:\Users\ilua2\OneDrive\–†–∞–±–æ—á–∏–π_—Å—Ç–æ–ª\–•–õ–ê–ú\–ü—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ\T25--4m_MLOps"


–ó–∞–ø—É—Å—Ç–∏—Ç—å Minikube:

minikube start


–ü–æ—Å—Ç—Ä–æ–∏—Ç—å Docker-–æ–±—Ä–∞–∑ –∏ –∑–∞–≥—Ä—É–∑–∏—Ç—å –≤ Minikube:

docker build -t durak-rl-api:lab10 .
minikube image load durak-rl-api:lab10


–ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∞–Ω–∏—Ñ–µ—Å—Ç—ã:

kubectl apply -f k8s/


–ü—Ä–æ–≤–µ—Ä–∏—Ç—å Pods –∏ —Å–µ—Ä–≤–∏—Å:

kubectl get pods,svc
minikube service durak-rl-api --url


–í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–æ–≤–∞—Ç—å —Å FastAPI:

# —Å–±—Ä–æ—Å –∏–≥—Ä—ã
Invoke-RestMethod -Uri "http://127.0.0.1:<PORT>/reset"

# —Å–¥–µ–ª–∞—Ç—å —Ö–æ–¥
Invoke-RestMethod -Uri "http://127.0.0.1:<PORT>/step" -Method POST -ContentType "application/json" -Body '{"action":"take"}'

# –ª–µ–≥–∞–ª—å–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è
Invoke-RestMethod -Uri "http://127.0.0.1:<PORT>/legal_actions"


–ü—Ä–æ–≤–µ—Ä–∫–∞ HPA –∏ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ:

kubectl get hpa
for ($i=0; $i -lt 200; $i++) { Invoke-RestMethod -Uri "http://127.0.0.1:<PORT>/reset" }
kubectl get pods -w